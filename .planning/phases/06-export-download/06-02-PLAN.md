---
phase: 06-export-download
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/hooks/useExport.ts
  - src/components/features/ExportButton.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a Download button after summarization completes with count of completed summaries"
    - "Clicking Download shows loading spinner, then triggers zip download"
    - "Download button is disabled when no completed summaries exist"
    - "Error state displays if export fails"
    - "Success state briefly displays after download triggers"
  artifacts:
    - path: "src/hooks/useExport.ts"
      provides: "useExport hook with status, error, isGenerating, exportSummaries, reset"
      exports: ["useExport"]
    - path: "src/components/features/ExportButton.tsx"
      provides: "ExportButton component with loading/success/default states"
      exports: ["ExportButton"]
    - path: "src/App.tsx"
      provides: "Export integration after summarization completion"
      contains: "useExport"
  key_links:
    - from: "src/hooks/useExport.ts"
      to: "src/services/export.service.ts"
      via: "import { exportSummariesToZip }"
      pattern: "exportSummariesToZip"
    - from: "src/App.tsx"
      to: "src/hooks/useExport.ts"
      via: "import { useExport }"
      pattern: "useExport"
    - from: "src/App.tsx"
      to: "src/components/features/ExportButton.tsx"
      via: "import { ExportButton }"
      pattern: "ExportButton"
---

<objective>
Wire the export functionality into the UI: create the useExport hook for state management, the ExportButton component for visual feedback, and integrate both into App.tsx after the summarization completion card.

Purpose: This plan connects the export service (Plan 06-01) to the user interface, completing the full export workflow from button click to zip download.
Output: Working download button that appears after summarization, triggers zip generation, and provides loading/success/error feedback.
</objective>

<execution_context>
@/Users/nathanstasin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathanstasin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-export-download/06-RESEARCH.md
@.planning/phases/06-export-download/06-01-SUMMARY.md
@src/App.tsx
@src/hooks/useSummarization.ts
@src/types/summary.ts
@src/types/youtube.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useExport hook and ExportButton component</name>
  <files>src/hooks/useExport.ts, src/components/features/ExportButton.tsx</files>
  <action>
    **useExport hook** (`src/hooks/useExport.ts`):
    - Manage export state: `status` as `'idle' | 'generating' | 'success' | 'error'`
    - `error` state as `string | null`
    - `exportSummaries(videos: VideoItem[], summaryResults: Map<string, SummaryResult>)`:
      1. Set status to 'generating', clear error
      2. Filter summaryResults to only entries with status 'completed' and a summary object
      3. Map completed results to `{ video, summary }` pairs by matching video.id
      4. If no completed summaries, throw error "No completed summaries to export"
      5. Call `exportSummariesToZip(completedSummaries)` from export.service
      6. Set status to 'success'
      7. After 2 seconds, reset status to 'idle' via setTimeout
      8. On error: set error message, set status to 'error'
    - `reset()`: set status to 'idle', clear error
    - Return: `{ status, error, isGenerating: status === 'generating', exportSummaries, reset }`
    - Use `useCallback` for stable references

    **ExportButton component** (`src/components/features/ExportButton.tsx`):
    - Props: `onExport: () => void`, `isGenerating: boolean`, `isSuccess: boolean`, `completedCount: number`, `disabled?: boolean`
    - Uses shadcn Button component with `size="lg"`
    - Three visual states:
      1. **Generating**: Loader2 spinning icon + "Generating zip..." text, button disabled
      2. **Success**: CheckCircle icon + "Downloaded!" text
      3. **Default**: Download icon + "Download Summaries ({completedCount})" text
    - Button disabled when: `disabled || isGenerating || completedCount === 0`
    - Import icons from lucide-react: Download, Loader2, CheckCircle
  </action>
  <verify>
    ```bash
    npm run build
    ```
    Build succeeds with no type errors.
  </verify>
  <done>useExport hook manages export lifecycle (idle -> generating -> success/error). ExportButton renders three visual states correctly.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate export into App.tsx</name>
  <files>src/App.tsx</files>
  <action>
    Wire the export hook and button into the main app layout:

    1. Add imports at top of file:
       ```typescript
       import { useExport } from '@/hooks/useExport'
       import { ExportButton } from '@/components/features/ExportButton'
       ```

    2. In AppContent, after the existing `useSummarization` hook, add:
       ```typescript
       const { status: exportStatus, error: exportError, isGenerating, exportSummaries } = useExport()
       ```

    3. Create handler function:
       ```typescript
       const handleExport = () => {
         exportSummaries(videos, state.results)  // state.results from useSummarization
       }
       ```
       Note: `useSummarization` already returns `results` as `Map<string, SummaryResult>`. Use that directly.

    4. Add ExportButton inside the completion summary block (where `summaryPhase === 'complete'`).
       Place it AFTER the existing completion message, inside the same conditional block:
       ```tsx
       {summaryPhase === 'complete' && completedCount > 0 && (
         <div className="flex justify-center">
           <ExportButton
             onExport={handleExport}
             isGenerating={isGenerating}
             isSuccess={exportStatus === 'success'}
             completedCount={completedCount}
           />
         </div>
       )}
       ```

    5. Add error display below the export button:
       ```tsx
       {exportError && (
         <div className="p-4 rounded-lg border bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800 text-center">
           <p className="text-sm text-red-900 dark:text-red-100">
             Export failed: {exportError}
           </p>
         </div>
       )}
       ```

    6. The `handleExport` needs access to both `videos` (from useChannelVideos) and the summary `results` Map (from useSummarization). The useSummarization hook already exposes `results` â€” destructure it if not already done:
       ```typescript
       const { ..., results: summaryResults } = useSummarization(keys.anthropicKey)
       ```
       Then: `exportSummaries(videos, summaryResults)`

    7. Also add export reset to the clear channel handler (the X button on channel card) so export state resets when channel is cleared.
  </action>
  <verify>
    ```bash
    npm run build
    npx vite preview &
    # Visually: load channel, select videos, extract, summarize, verify Download button appears
    ```
    Build succeeds. Download button appears after summarization completes. Button shows count of completed summaries.
  </verify>
  <done>Export button appears after summarization completes. Clicking it generates and downloads a zip file. Loading/success/error states display correctly. Channel clear also resets export state.</done>
</task>

</tasks>

<verification>
```bash
npm run build
npx vitest run
```
Build succeeds with no type errors. All existing tests still pass. Export button visible in UI after summarization phase completes.
</verification>

<success_criteria>
- useExport hook manages idle/generating/success/error states correctly
- ExportButton shows loading spinner during generation, checkmark on success, download icon by default
- Export button appears in App.tsx only when summaryPhase === 'complete' and completedCount > 0
- Clicking export triggers zip download via exportSummariesToZip
- Export errors display below the button
- Clearing channel resets export state
- Build passes, all existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-export-download/06-02-SUMMARY.md`
</output>
