---
phase: 04-transcript-extraction
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - src/hooks/useTranscriptExtraction.ts
  - src/components/features/TranscriptStatus.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can trigger transcript extraction for selected videos"
    - "UI shows per-video extraction status (pending, fetching, success, error)"
    - "Videos without captions display 'No captions available' indicator"
    - "Extraction results are accessible for downstream summarization"
  artifacts:
    - path: "src/hooks/useTranscriptExtraction.ts"
      provides: "React hook managing transcript extraction state and triggering"
      exports: ["useTranscriptExtraction"]
    - path: "src/components/features/TranscriptStatus.tsx"
      provides: "UI component showing per-video transcript extraction status"
      exports: ["TranscriptStatus"]
  key_links:
    - from: "src/hooks/useTranscriptExtraction.ts"
      to: "src/services/transcript.service.ts"
      via: "fetchTranscripts import"
      pattern: "fetchTranscripts"
    - from: "src/components/features/TranscriptStatus.tsx"
      to: "src/types/transcript.ts"
      via: "TranscriptResult type"
      pattern: "TranscriptResult"
    - from: "src/App.tsx"
      to: "src/hooks/useTranscriptExtraction.ts"
      via: "useTranscriptExtraction hook"
      pattern: "useTranscriptExtraction"
---

<objective>
Wire transcript extraction into the UI with a React hook for state management and status indicators per video.

Purpose: Users need to trigger transcript extraction for their selected videos and see real-time feedback on which videos succeeded, failed, or are still processing. This connects the TranscriptService (Plan 02) and Edge Function (Plan 01) to the existing selection UI (Phase 3).
Output: Working "Extract Transcripts" flow with per-video status indicators in the UI.
</objective>

<execution_context>
@/Users/nathanstasin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathanstasin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-transcript-extraction/04-01-SUMMARY.md
@.planning/phases/04-transcript-extraction/04-02-SUMMARY.md
@.planning/phases/03-video-selection/03-02-SUMMARY.md
@src/hooks/useVideoSelection.ts
@src/components/features/SelectionToolbar.tsx
@src/App.tsx
@src/types/transcript.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useTranscriptExtraction hook</name>
  <files>src/hooks/useTranscriptExtraction.ts</files>
  <action>
    Create `src/hooks/useTranscriptExtraction.ts`:

    State managed:
    - `results: Map<string, TranscriptResult>` — keyed by videoId, stores extraction results
    - `isExtracting: boolean` — true while any extraction is in progress
    - `extractionComplete: boolean` — true after extraction run finishes

    Exposed API:
    - `extractTranscripts(videoIds: string[]): void` — triggers extraction for given video IDs
    - `results: Map<string, TranscriptResult>` — current results map
    - `isExtracting: boolean`
    - `successCount: number` — count of successful extractions
    - `errorCount: number` — count of failed extractions
    - `getResult(videoId: string): TranscriptResult | undefined`
    - `reset(): void` — clears all results

    Implementation details:
    - Use `useState` for results map and isExtracting flag
    - On `extractTranscripts` call:
      1. Set isExtracting = true
      2. Initialize all videoIds in results map with status 'pending'
      3. Call `fetchTranscripts(videoIds)` from transcript.service.ts
      4. As results come back, update the results map (note: fetchTranscripts returns all at once since p-limit handles concurrency internally, so update all results when Promise resolves)
      5. Set isExtracting = false, extractionComplete = true
    - Derive successCount and errorCount from results map using useMemo
    - Store results in component state only (not sessionStorage — transcripts are large)
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>
    useTranscriptExtraction hook created with: extractTranscripts trigger, per-video result tracking, isExtracting loading state, success/error counts, reset function.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TranscriptStatus component and wire into App</name>
  <files>src/components/features/TranscriptStatus.tsx, src/App.tsx</files>
  <action>
    1. Create `src/components/features/TranscriptStatus.tsx`:

    A small inline status indicator that shows next to each video card (or in the SelectionToolbar area). Accepts a TranscriptResult and renders:
    - `pending`: gray dot or dash (no text needed)
    - `fetching`: spinning loader icon (use Lucide `Loader2` with `animate-spin`)
    - `success`: green checkmark (Lucide `Check`) + "Transcript ready"
    - `error`: red X (Lucide `X`) + error message text (e.g., "No captions available")

    Use Tailwind classes for colors. Keep component small — just an icon + optional text.
    Accept `result: TranscriptResult | undefined` prop (undefined = not yet attempted).

    2. Create an "Extract Transcripts" button in or near the SelectionToolbar area:

    Modify `src/App.tsx` to:
    - Import and call `useTranscriptExtraction()`
    - Add an "Extract Transcripts" button that appears when videos are selected and extraction hasn't started
    - Button calls `extractTranscripts(Array.from(selectedVideoIds))`
    - Button is disabled while `isExtracting` is true, shows "Extracting..." with spinner
    - After extraction completes, show summary: "X transcripts ready, Y failed"
    - Pass transcript results down to VideoCard components so TranscriptStatus can render per-video

    3. Integrate TranscriptStatus into VideoCard (or adjacent to it):
    - In the video list rendering, pass the transcript result for each video
    - Show TranscriptStatus next to each video that has been processed
    - Videos not yet processed show no indicator

    Do NOT modify SelectionToolbar.tsx directly — add the extract button as a sibling in App.tsx to keep concerns separate. The extract button only appears after selection, as a next step in the workflow.
  </action>
  <verify>
    - `npm run build` succeeds
    - `npm test` passes (no regressions)
    - TranscriptStatus component renders different states
    - Extract button appears in App when videos selected
  </verify>
  <done>
    TranscriptStatus component renders per-video extraction status (pending/fetching/success/error).
    Extract Transcripts button in App triggers extraction for selected videos.
    Extraction results visible per-video in the UI.
    Summary count (X ready, Y failed) shown after extraction completes.
  </done>
</task>

</tasks>

<verification>
- `npm run build` passes
- `npm test` passes with no regressions
- Extract Transcripts button appears when videos are selected
- Per-video status indicators render correctly for all states
- Summary shows success/failure counts after extraction
</verification>

<success_criteria>
- User can click "Extract Transcripts" to process selected videos
- Each video shows its extraction status (pending, fetching, success, error)
- Videos without captions show "No captions available" with error indicator
- Success/failure counts displayed after extraction completes
- Transcript data stored in hook state, accessible for Phase 5 summarization
</success_criteria>

<output>
After completion, create `.planning/phases/04-transcript-extraction/04-03-SUMMARY.md`
</output>
