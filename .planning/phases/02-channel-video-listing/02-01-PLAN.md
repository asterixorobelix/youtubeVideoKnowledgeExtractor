---
phase: 02-channel-video-listing
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/types/youtube.ts
  - src/lib/youtube/parse-channel-url.ts
  - src/lib/youtube/__tests__/parse-channel-url.test.ts
autonomous: true

must_haves:
  truths:
    - "Any YouTube channel URL format (@handle, /c/, /channel/, /user/) is correctly parsed to an identifier"
    - "Invalid URLs produce a clear error, not a crash"
  artifacts:
    - path: "src/types/youtube.ts"
      provides: "Channel and video TypeScript types"
      contains: "ChannelIdentifier"
    - path: "src/lib/youtube/parse-channel-url.ts"
      provides: "URL parsing function"
      exports: ["parseChannelUrl"]
    - path: "src/lib/youtube/__tests__/parse-channel-url.test.ts"
      provides: "Test coverage for all URL formats"
      min_lines: 40
  key_links:
    - from: "src/lib/youtube/parse-channel-url.ts"
      to: "src/types/youtube.ts"
      via: "import type"
      pattern: "import type.*ChannelIdentifier"
---

<objective>
TDD implementation of YouTube channel URL parsing and core YouTube types.

Purpose: YouTube supports multiple channel URL formats (@handle, /c/name, /channel/UCxxx, /user/name). Parsing these correctly is the foundation for all YouTube API calls in Phase 2. TDD ensures all 6+ URL patterns are handled with confidence.

Output: Tested URL parser + TypeScript types for channels, videos, and API responses.
</objective>

<execution_context>
@/Users/nathanstasin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathanstasin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-channel-video-listing/02-RESEARCH.md
@src/types/api-keys.ts
</context>

<feature>
  <name>YouTube Channel URL Parser</name>
  <files>
    src/types/youtube.ts
    src/lib/youtube/parse-channel-url.ts
    src/lib/youtube/__tests__/parse-channel-url.test.ts
  </files>
  <behavior>
    parseChannelUrl(url: string) -> ChannelIdentifier | ParseError

    Test cases (input -> expected output):
    - "https://www.youtube.com/@MrBeast" -> { type: "handle", value: "MrBeast" }
    - "https://youtube.com/@MrBeast" -> { type: "handle", value: "MrBeast" }
    - "https://www.youtube.com/c/Fireship" -> { type: "customUrl", value: "Fireship" }
    - "https://www.youtube.com/channel/UCBcRF18a7Qf58cCRy5xuWwQ" -> { type: "channelId", value: "UCBcRF18a7Qf58cCRy5xuWwQ" }
    - "https://www.youtube.com/user/Google" -> { type: "username", value: "Google" }
    - "@MrBeast" -> { type: "handle", value: "MrBeast" } (bare handle, no URL)
    - "UCBcRF18a7Qf58cCRy5xuWwQ" -> { type: "channelId", value: "UCBcRF18a7Qf58cCRy5xuWwQ" } (bare channel ID starting with UC)
    - "" -> error
    - "https://google.com" -> error
    - "https://youtube.com/watch?v=abc" -> error (video URL, not channel)
    - "not a url at all" -> error

    Types to define in src/types/youtube.ts:
    - ChannelIdentifier: { type: "handle" | "channelId" | "username" | "customUrl", value: string }
    - ChannelInfo: { id: string, title: string, thumbnail: string, uploadsPlaylistId: string }
    - VideoItem: { id: string, title: string, thumbnail: string, publishedAt: string, duration: string }
    - VideosPage: { videos: VideoItem[], nextPageToken: string | null, totalResults: number }
    - YouTubeApiError: { code: number, message: string, isQuotaExhausted: boolean, quotaResetTime: Date | null }
  </behavior>
  <implementation>
    1. Install vitest as dev dependency (project has no test runner yet): npm install -D vitest
    2. Add "test" script to package.json: "vitest run" and "test:watch": "vitest"

    RED phase:
    - Create src/types/youtube.ts with all type definitions
    - Create test file with all cases above using vitest describe/it/expect
    - Run vitest -- all tests MUST fail (function doesn't exist yet)

    GREEN phase:
    - Create src/lib/youtube/parse-channel-url.ts
    - Implementation approach:
      a. Try to parse as URL first (new URL())
      b. If valid URL, check hostname includes "youtube.com" or "youtu.be"
      c. Extract path segments and match patterns:
         - /@{handle} -> handle
         - /c/{name} -> customUrl
         - /channel/{id} -> channelId
         - /user/{name} -> username
      d. If not a valid URL, check for bare handle (@xxx) or bare channel ID (UC prefix, 24 chars)
      e. Return error for anything else
    - Run vitest -- all tests MUST pass

    REFACTOR phase (if needed):
    - Clean up regex patterns
    - Ensure error messages are user-friendly (e.g., "Please enter a YouTube channel URL, not a video URL")
  </implementation>
</feature>

<verification>
- `npx vitest run` passes all test cases
- `npx tsc --noEmit` passes (type safety verified)
- All 6+ URL format variations produce correct ChannelIdentifier
- Invalid inputs produce descriptive error messages, not crashes
</verification>

<success_criteria>
- All test cases pass (11+ cases covering valid formats, bare inputs, and error cases)
- Types exported and importable from @/types/youtube
- Parser exported and importable from @/lib/youtube/parse-channel-url
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-channel-video-listing/02-01-SUMMARY.md`
</output>
