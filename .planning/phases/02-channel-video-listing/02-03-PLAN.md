---
phase: 02-channel-video-listing
plan: 03
type: execute
wave: 3
depends_on: ["02-01", "02-02"]
files_modified:
  - src/components/features/ChannelInput.tsx
  - src/components/features/VideoList.tsx
  - src/components/features/VideoCard.tsx
  - src/components/features/QuotaStatus.tsx
  - src/hooks/useChannelVideos.ts
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "User can paste any YouTube channel URL and see a list of videos"
    - "Video list displays title, thumbnail, duration placeholder, and upload date"
    - "User can click 'Load More' to fetch the next 50 videos"
    - "Quota exhaustion shows error with reset time, not a crash"
    - "Loading and empty states are handled gracefully"
  artifacts:
    - path: "src/components/features/ChannelInput.tsx"
      provides: "Channel URL input form with validation"
      min_lines: 30
    - path: "src/components/features/VideoList.tsx"
      provides: "Paginated video list with load more"
      min_lines: 40
    - path: "src/components/features/VideoCard.tsx"
      provides: "Individual video display card"
      min_lines: 20
    - path: "src/hooks/useChannelVideos.ts"
      provides: "React hook orchestrating channel resolution + video fetching"
      exports: ["useChannelVideos"]
    - path: "src/App.tsx"
      provides: "Updated app shell with channel input and video list"
  key_links:
    - from: "src/hooks/useChannelVideos.ts"
      to: "src/lib/youtube/youtube-api.ts"
      via: "calls resolveChannel and fetchVideosPage"
      pattern: "resolveChannel|fetchVideosPage"
    - from: "src/hooks/useChannelVideos.ts"
      to: "src/lib/youtube/parse-channel-url.ts"
      via: "parses URL before API call"
      pattern: "parseChannelUrl"
    - from: "src/hooks/useChannelVideos.ts"
      to: "src/context/ApiKeysContext.tsx"
      via: "reads YouTube API key"
      pattern: "useApiKeys"
    - from: "src/components/features/ChannelInput.tsx"
      to: "src/hooks/useChannelVideos.ts"
      via: "receives hook callbacks as props or uses hook directly"
      pattern: "useChannelVideos|onSubmit"
    - from: "src/components/features/VideoList.tsx"
      to: "src/components/features/VideoCard.tsx"
      via: "maps videos to cards"
      pattern: "VideoCard"
---

<objective>
Build the complete UI for channel URL input, video listing with pagination, and quota error display.

Purpose: This is the user-facing layer that connects the URL parser and API service to a working interface. After this plan, a user can paste a YouTube channel URL and browse its videos -- the core Phase 2 deliverable.

Output: Channel input form, video list with cards, load more pagination, quota status display, and the orchestrating React hook.
</objective>

<execution_context>
@/Users/nathanstasin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathanstasin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-channel-video-listing/02-RESEARCH.md
@.planning/phases/02-channel-video-listing/02-01-SUMMARY.md
@.planning/phases/02-channel-video-listing/02-02-SUMMARY.md
@src/types/youtube.ts
@src/lib/youtube/parse-channel-url.ts
@src/lib/youtube/youtube-api.ts
@src/lib/youtube/cache.ts
@src/lib/youtube/quota.ts
@src/context/ApiKeysContext.tsx
@src/components/features/ApiKeyForm.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: useChannelVideos hook and UI components</name>
  <files>
    src/hooks/useChannelVideos.ts
    src/components/features/ChannelInput.tsx
    src/components/features/VideoCard.tsx
    src/components/features/VideoList.tsx
    src/components/features/QuotaStatus.tsx
  </files>
  <action>
    Create src/hooks/useChannelVideos.ts:
    - Custom hook that orchestrates the full flow: parse URL -> resolve channel -> fetch videos -> paginate
    - State: { channel: ChannelInfo | null, videos: VideoItem[], nextPageToken: string | null, totalResults: number, isLoading: boolean, isLoadingMore: boolean, error: string | null, isQuotaExhausted: boolean, quotaResetTime: Date | null }
    - fetchChannel(url: string): async function that:
      1. Calls parseChannelUrl(url) -- if error, set error state and return
      2. Gets apiKey from useApiKeys() context
      3. If no YouTube key, set error "Please configure your YouTube API key first"
      4. Calls resolveChannel(identifier, apiKey)
      5. Calls fetchVideosPage(channel.uploadsPlaylistId, apiKey)
      6. Sets channel, videos, nextPageToken, totalResults
      7. On error: if isQuotaExhausted, set quota state; otherwise set error message
    - loadMore(): async function that:
      1. If no nextPageToken, return
      2. Sets isLoadingMore = true
      3. Calls fetchVideosPage with current nextPageToken
      4. Appends new videos to existing array
      5. Updates nextPageToken
    - Returns: { channel, videos, nextPageToken, totalResults, isLoading, isLoadingMore, error, isQuotaExhausted, quotaResetTime, fetchChannel, loadMore }

    Create src/components/features/ChannelInput.tsx:
    - Uses React Hook Form + Zod for validation (same pattern as ApiKeyForm)
    - Zod schema: z.object({ url: z.string().min(1, "Please enter a channel URL") })
    - Input field with placeholder "Paste a YouTube channel URL (e.g., youtube.com/@MrBeast)"
    - Submit button labeled "Load Videos" with loading spinner when isLoading
    - Shows error message below input if error state is set (red text, use destructive variant)
    - Uses shadcn/ui Input, Button, Label components
    - Disabled while loading

    Create src/components/features/VideoCard.tsx:
    - Props: video: VideoItem
    - Display: thumbnail image (lazy loaded with loading="lazy"), title, formatted upload date
    - Upload date: format publishedAt ISO string to readable date (e.g., "Jan 15, 2024") using Intl.DateTimeFormat
    - Layout: horizontal card -- thumbnail on left (120x68px or 16:9 aspect ratio), text on right
    - Tailwind classes: rounded border, hover shadow transition, overflow-hidden for thumbnail
    - Thumbnail: use img tag with alt={title}, width/height attributes for layout stability

    Create src/components/features/VideoList.tsx:
    - Props: videos: VideoItem[], isLoadingMore: boolean, hasMore: boolean (nextPageToken !== null), onLoadMore: () => void, totalResults: number
    - Renders: list of VideoCard components with keys
    - Shows count: "{videos.length} of {totalResults} videos"
    - "Load More" button at bottom when hasMore is true
    - Loading spinner on "Load More" button when isLoadingMore
    - Empty state: "No videos found for this channel" when videos is empty and not loading

    Create src/components/features/QuotaStatus.tsx:
    - Props: isQuotaExhausted: boolean, quotaResetTime: Date | null
    - When quota exhausted: show amber/yellow alert box with:
      - "YouTube API quota exceeded"
      - "Quota resets at {formatted time}" using Intl.DateTimeFormat with timeZoneName
      - "Cached results are still available below" (if there are cached videos)
    - When NOT exhausted: render nothing (return null)
    - Use shadcn/ui Alert component if available, otherwise styled div with Tailwind
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - All 5 files exist and export their components/hooks
    - Hook imports from parse-channel-url, youtube-api, cache, quota, and ApiKeysContext
    - Components use shadcn/ui primitives (Button, Input, Label)
  </verify>
  <done>
    - useChannelVideos hook orchestrates full parse -> resolve -> fetch -> paginate flow
    - ChannelInput validates URL and triggers fetch
    - VideoCard displays thumbnail, title, date
    - VideoList renders cards with "Load More" pagination
    - QuotaStatus shows quota error with reset time
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire into App shell and verify build</name>
  <files>src/App.tsx</files>
  <action>
    Update src/App.tsx to create the full Phase 2 flow:
    - Keep ApiKeysProvider wrapper
    - Create a new layout:
      1. Header area: app title + API key configuration (collapse ApiKeyForm into a settings section or show it when keys not configured)
      2. Main area: ChannelInput at top, then VideoList below
      3. QuotaStatus between ChannelInput and VideoList

    Conditional rendering:
    - If !hasKeys (from useApiKeys): show ApiKeyForm prominently (current behavior)
    - If hasKeys: show ChannelInput + VideoList layout
    - Show a small "Settings" or key icon button to re-open ApiKeyForm even when keys are set

    Use useChannelVideos hook in App or create a wrapper component.

    Layout approach (Tailwind):
    - max-w-4xl mx-auto (wider than current max-w-lg to accommodate video cards)
    - Stack: header -> channel input -> quota status -> video list
    - Responsive: cards stack on mobile, stay horizontal on desktop

    Install any missing shadcn/ui components needed (Alert if used by QuotaStatus):
    - Run: npx shadcn@latest add alert (if Alert component doesn't exist)

    Run `npm run build` to verify the full build succeeds with zero errors.
  </action>
  <verify>
    - `npm run build` succeeds with zero errors
    - `npm run dev` starts and the app renders without console errors
    - App shows ApiKeyForm when no keys configured
    - App shows ChannelInput when keys are configured
  </verify>
  <done>
    - App shell updated with channel input and video list layout
    - Conditional rendering: API key form vs channel browsing
    - Build passes with zero TypeScript or bundling errors
    - Dev server runs without console errors
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete channel video listing flow: URL input, API integration, video display with pagination, and quota error handling</what-built>
  <how-to-verify>
    1. Run `npm run dev` and open http://localhost:5173
    2. Enter your YouTube Data API key (should already have one from Phase 1)
    3. Paste a YouTube channel URL (try: https://www.youtube.com/@Fireship)
    4. Verify: video list appears with thumbnails, titles, and dates
    5. Scroll down and click "Load More" -- verify more videos append
    6. Try an invalid URL (e.g., "not a url") -- verify error message appears
    7. Try a non-existent channel -- verify "Channel not found" error
    8. Check browser console for any errors
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
- `npm run build` passes with zero errors
- App renders channel input when API keys are configured
- Pasting a valid channel URL loads videos with thumbnails
- "Load More" appends next page of videos
- Invalid URLs show error messages
- Quota exhaustion shows reset time (can't easily test without burning quota)
- All components use shadcn/ui and Tailwind styling
</verification>

<success_criteria>
- User can paste any YouTube channel URL format and see videos (CHAN-01, CHAN-02)
- Video list shows title, thumbnail, and upload date (CHAN-03)
- "Load More" fetches next 50 videos (CHAN-04)
- Quota exhaustion displays error with reset time
- Build and dev server run without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-channel-video-listing/02-03-SUMMARY.md`
</output>
